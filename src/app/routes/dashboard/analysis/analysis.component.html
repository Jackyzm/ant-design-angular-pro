<div class="analysis">
    <div nz-row nzGutter="24">
        <div
            nz-col
            [nzXs]="24"
            [nzSm]="12"
            [nzMd]="12"
            [nzLg]="12"
            [nzXl]="6"
            style="margin-bottom: 24px;"
        >
            <app-chart-card
                [bordered]="false"
                title="总销售额"
                [contentHeight]="46"
                [action]="actionTemplate"
                [total]="totalTemplateOne"
                [content]="contentTemplateOne"
                [footer]="footerTemplateOne"
            >
                <ng-template #actionTemplate>
                    <span nz-tooltip nzTitle="指标说明">
                        <i nz-icon type="info-circle-o"></i>
                    </span>
                </ng-template>
                <ng-template #totalTemplateOne>
                    <span>{{ yuan(126560) }}</span>
                </ng-template>
                <ng-template #contentTemplateOne>
                    <app-trend
                        flag="up"
                        [trendStyle]="{ 'margin-right.px': 16 }"
                        [number]="numberTemplateOne"
                    >
                        <ng-template #numberTemplateOne>
                            周同比 <span class="trendText">12%</span>
                        </ng-template>
                    </app-trend>
                    <app-trend flag="down" [number]="numberTemplateTwo">
                        <ng-template #numberTemplateTwo>
                            日环比 <span class="trendText">11%</span>
                        </ng-template>
                    </app-trend>
                </ng-template>
                <ng-template #footerTemplateOne>
                    <app-field
                        label="日均销售额"
                        [value]="'￥' + numeral(12423).format('0,0')"
                    ></app-field>
                </ng-template>
            </app-chart-card>
        </div>
        <div
            nz-col
            [nzXs]="24"
            [nzSm]="12"
            [nzMd]="12"
            [nzLg]="12"
            [nzXl]="6"
            style="margin-bottom: 24px;"
        >
            <app-chart-card
                [bordered]="false"
                title="访问量"
                [contentHeight]="46"
                [action]="actionTemplate"
                [total]="totalTemplateTwo"
                [content]="contentTemplateTwo"
                [footer]="footerTemplateTwo"
            >
                <ng-template #totalTemplateTwo>
                    <span>{{ numeral(8846).format("0,0") }}</span>
                </ng-template>
                <ng-template #contentTemplateTwo>
                    <app-mini-area
                        color="#975FE4"
                        [data]="visitData"
                    ></app-mini-area>
                </ng-template>
                <ng-template #footerTemplateTwo>
                    <app-field
                        label="日访问量"
                        [value]="'￥' + numeral(1234).format('0,0')"
                    ></app-field>
                </ng-template>
            </app-chart-card>
        </div>
        <div
            nz-col
            [nzXs]="24"
            [nzSm]="12"
            [nzMd]="12"
            [nzLg]="12"
            [nzXl]="6"
            style="margin-bottom: 24px;"
        >
            <app-chart-card
                [bordered]="false"
                title="支付笔数"
                [contentHeight]="46"
                [action]="actionTemplate"
                [total]="totalTemplateThree"
                [content]="contentTemplateThree"
                [footer]="footerTemplateThree"
            >
                <ng-template #totalTemplateThree>
                    <span>{{ numeral(6560).format("0,0") }}</span>
                </ng-template>
                <ng-template #contentTemplateThree>
                    <app-mini-bar [data]="visitData"></app-mini-bar>
                </ng-template>
                <ng-template #footerTemplateThree>
                    <app-field label="转化率" value="60%"></app-field>
                </ng-template>
            </app-chart-card>
        </div>
        <div
            nz-col
            [nzXs]="24"
            [nzSm]="12"
            [nzMd]="12"
            [nzLg]="12"
            [nzXl]="6"
            style="margin-bottom: 24px;"
        >
            <app-chart-card
                [bordered]="false"
                title="运营活动效果"
                [contentHeight]="46"
                [action]="actionTemplate"
                [total]="totalTemplateFour"
                [content]="contentTemplateFour"
                [footer]="footerTemplateFour"
            >
                <ng-template #totalTemplateFour> <span>78%</span> </ng-template>
                <ng-template #contentTemplateFour>
                    <app-mini-progress
                        [percent]="78"
                        [strokeWidth]="8"
                        [target]="80"
                        color="#13C2C2"
                    ></app-mini-progress>
                </ng-template>
                <ng-template #footerTemplateFour>
                    <div
                        style="white-space: 'nowrap'; overflow: 'hidden'; display: flex;"
                    >
                        <app-trend
                            flag="up"
                            [trendStyle]="{ flex: 1 }"
                            [number]="numberTemplateThree"
                            style="width:50%;"
                        >
                            <ng-template #numberTemplateThree>
                                周同比 <span class="trendText">12%</span>
                            </ng-template>
                        </app-trend>
                        <app-trend
                            flag="down"
                            [trendStyle]="{ flex: 1 }"
                            [number]="numberTemplateFour"
                            style="width:50%;"
                        >
                            <ng-template #numberTemplateFour>
                                日环比<span class="trendText">11%</span>
                            </ng-template>
                        </app-trend>
                    </div>
                </ng-template>
            </app-chart-card>
        </div>
    </div>

    <nz-card nzBordered="false" [nzBodyStyle]="{ padding: 0 }">
        <div class="salesCard">
            <nz-tabset
                size="large"
                [nzTabBarStyle]="{ marginBottom: 24 }"
                [nzTabBarExtraContent]="nzTabBarExtraContentTemplate"
            >
                <ng-template #nzTabBarExtraContentTemplate>
                    <div class="salesExtraWrap">
                        <div class="salesExtra">
                            <a
                                [class]="isActive('today')"
                                (click)="selectDate('today')"
                                >今日</a
                            >
                            <a
                                [class]="isActive('week')"
                                (click)="selectDate('week')"
                                >本周</a
                            >
                            <a
                                [class]="isActive('month')"
                                (click)="selectDate('month')"
                                >本月</a
                            >
                            <a
                                [class]="isActive('year')"
                                (click)="selectDate('year')"
                                >全年</a
                            >
                        </div>
                        <nz-range-picker
                            [ngModel]="rangePickerValue"
                            (ngModelChange)="handleRangePickerChange($event)"
                            style="width: 256px;"
                        ></nz-range-picker>
                    </div>
                </ng-template>
                <nz-tab nzTitle="销售额" key="sales">
                    <div nz-row>
                        <div
                            nz-col
                            [nzXl]="16"
                            [nzLg]="12"
                            [nzMd]="12"
                            [nzSm]="24"
                            [nzXs]="24"
                        >
                            <div class="salesBar">
                                <app-bar
                                    [height]="295"
                                    title="销售额趋势"
                                    [data]="salesData"
                                ></app-bar>
                            </div>
                        </div>
                        <div
                            nz-col
                            [nzXl]="8"
                            [nzLg]="12"
                            [nzMd]="12"
                            [nzSm]="24"
                            [nzXs]="24"
                        >
                            <div class="salesRank">
                                <h4 class="rankingTitle">门店销售额排名</h4>
                                <ul class="rankingList">
                                    <li
                                        *ngFor="
                                            let item of rankingListData;
                                            let i = index
                                        "
                                    >
                                        <span [class]="i < 3 ? 'active' : ''">{{
                                            i + 1
                                        }}</span>
                                        <span>{{ item.title }}</span>
                                        <span>{{
                                            numeral(item.total).format("0,0")
                                        }}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nz-tab>
                <nz-tab nzTitle="访问量" key="views">
                    <div nz-row>
                        <div
                            nz-col
                            [nzXl]="16"
                            [nzLg]="12"
                            [nzMd]="12"
                            [nzSm]="24"
                            [nzXs]="24"
                        >
                            <div class="salesBar">
                                <app-bar
                                    [height]="295"
                                    title="访问量趋势"
                                    [data]="salesData"
                                ></app-bar>
                            </div>
                        </div>
                        <div
                            nz-col
                            [nzXl]="8"
                            [nzLg]="12"
                            [nzMd]="12"
                            [nzSm]="24"
                            [nzXs]="24"
                        >
                            <div class="salesRank">
                                <h4 class="rankingTitle">门店访问量排名</h4>
                                <ul class="rankingList">
                                    <li
                                        *ngFor="
                                            let item of rankingListData;
                                            let i = index
                                        "
                                    >
                                        <span [class]="i < 3 ? 'active' : ''">{{
                                            i + 1
                                        }}</span>
                                        <span>{{ item.title }}</span>
                                        <span>{{
                                            numeral(item.total).format("0,0")
                                        }}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nz-tab>
            </nz-tabset>
        </div>
    </nz-card>

    <div nz-row [nzGutter]="24">
        <div nz-col [nzXl]="12" [nzLg]="24" [nzMd]="24" [nzSm]="24" [nzXs]="24">
            <nz-card
                [nzLoading]="loading"
                [nzBordered]="false"
                nzTitle="线上热门搜索"
                style="margin-top: 24px;"
                [nzExtra]="extraTemplate"
            >
                <ng-template #extraTemplate>
                    <span class="iconGroup">
                        <nz-dropdown nzPlacement="bottomRight">
                            <span nz-dropdown>
                                <i nz-icon type="ellipsis"></i>
                            </span>
                            <ul nz-menu>
                                <li nz-menu-item>操作一</li>
                                <li nz-menu-item>操作二</li>
                            </ul>
                        </nz-dropdown>
                    </span>
                </ng-template>
                <div nz-row [nzGutter]="68">
                    <div
                        nz-col
                        [nzSm]="12"
                        [nzXs]="24"
                        style="margin-bottom: 24px;"
                    >
                        <app-number-info
                            [gap]="8"
                            [total]="numeral(12321).format('0,0')"
                            status="up"
                            [subTotal]="17.1"
                            [subTitle]="subTitleTemplate"
                        >
                            <ng-template #subTitleTemplate>
                                <div class="numberInfoSubTitle">
                                    <span>
                                        搜索用户数
                                        <span nz-tooltip nzTitle="指标文案">
                                            <i
                                                nz-icon
                                                style="margin-left: 8px;"
                                                type="info-circle-o"
                                            ></i>
                                        </span>
                                    </span>
                                </div>
                            </ng-template>
                        </app-number-info>
                        <app-mini-area
                            [height]="45"
                            [data]="visitData2"
                        ></app-mini-area>
                    </div>
                    <div
                        nz-col
                        [nzSm]="12"
                        [nzXs]="24"
                        style="margin-bottom: 24px;"
                    >
                        <app-number-info
                            subTitle="人均搜索次数"
                            total="2.7"
                            status="down"
                            [subTotal]="26.2"
                            [gap]="8"
                        ></app-number-info>
                        <app-mini-area
                            [height]="45"
                            [data]="visitData2"
                        ></app-mini-area>
                    </div>
                </div>
                <nz-table
                    #basicTable
                    nzSize="small"
                    [nzData]="tableData"
                    [nzPageSize]="5"
                    class="analysisTable"
                >
                    <thead (nzSortChange)="sort($event)" nzSingleSort>
                        <tr>
                            <th>排名</th>
                            <th>搜索关键词</th>
                            <th nzShowSort nzSortKey="count" class="alignRight">
                                用户数
                            </th>
                            <th
                                nzShowSort
                                nzSortKey="range"
                                style="text-align:right;"
                            >
                                周涨幅
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of basicTable.data">
                            <td>{{ data.index }}</td>
                            <td>
                                <a href="javascript:;">{{ data.keyword }}</a>
                            </td>
                            <td class="alignRight">{{ data.count }}</td>
                            <td style="text-align:right;">
                                <app-trend
                                    [flag]="data.status === 1 ? 'down' : 'up'"
                                    [number]="numberTemplate"
                                >
                                    <ng-template #numberTemplate>
                                        <span style="margin-right: 4px;"
                                            >{{ data.range }}%</span
                                        >
                                    </ng-template>
                                </app-trend>
                            </td>
                        </tr>
                    </tbody>
                </nz-table>
            </nz-card>
        </div>
        <div nz-col [nzXl]="12" [nzLg]="24" [nzMd]="24" [nzSm]="24" [nzXs]="24">
            <nz-card
                [nzLoading]="loading"
                class="salesCard"
                [nzBordered]="false"
                nzTitle="销售额类别占比"
                [nzBodyStyle]="{ padding: 24 }"
                [nzExtra]="extraTemplateTwo"
                style="margin-top: 24px; min-height: 509px;"
            >
                <ng-template #extraTemplateTwo>
                    <div class="salesCardExtra">
                        <span class="iconGroup">
                            <nz-dropdown nzPlacement="bottomRight">
                                <span nz-dropdown>
                                    <i nz-icon type="ellipsis"></i>
                                </span>
                                <ul nz-menu>
                                    <li nz-menu-item>操作一</li>
                                    <li nz-menu-item>操作二</li>
                                </ul>
                            </nz-dropdown>
                        </span>
                        <div class="salesTypeRadio">
                            <nz-radio-group
                                [(ngModel)]="salesType"
                                (ngModelChange)="handleChangeSalesType($event)"
                            >
                                <label nz-radio-button nzValue="all"
                                    >全部渠道</label
                                >
                                <label nz-radio-button nzValue="online"
                                    >线上</label
                                >
                                <label nz-radio-button nzValue="offline"
                                    >门店</label
                                >
                            </nz-radio-group>
                        </div>
                    </div>
                </ng-template>
                <h4 style="margin-top: 8px; margin-bottom: 32px;">销售额</h4>
                <app-pie
                    [hasLegend]="true"
                    subTitle="销售额"
                    [data]="salesPieData"
                    [total]="total"
                    [valueFormat]="valueFormat"
                    [height]="248"
                    [colors]="colors"
                ></app-pie>
            </nz-card>
        </div>
    </div>
    <nz-card
        [nzLoading]="loading"
        class="offlineCard"
        [nzBordered]="false"
        [nzBodyStyle]="{ padding: '0 0 32px 0' }"
        style="margin-top: 32px;"
    >
        <nz-tabset
            [nzSelectedIndex]="activeIndex"
            (nzSelectChange)="handleTabChange($event)"
        >
            <nz-tab
                *ngFor="let shop of offlineData; let i = index"
                [nzTitle]="nzTitleTemplate"
            >
                <ng-template #nzTitleTemplate>
                    <div
                        nz-row
                        [nzGutter]="8"
                        style="width: 138px; margin: 8px 0;"
                    >
                        <div nz-col [nzSpan]="12">
                            <app-number-info
                                [title]="shop.name"
                                subTitle="转化率"
                                [gap]="2"
                                [total]="shop.cvr * 100 + '%'"
                                [theme]="activeIndex !== i ? 'light' : ''"
                            ></app-number-info>
                        </div>
                        <div nz-col [nzSpan]="12" style="padding-top: 36px;">
                            <app-mini-pie
                                [color]="activeIndex !== i ? '#BDE4FF' : ''"
                                [percent]="shop.cvr * 100"
                                [height]="64"
                                [radius]="['36%', '66%']"
                            ></app-mini-pie>
                        </div>
                    </div>
                </ng-template>
                <div style="padding: '0 24px'">
                    <app-timeline-chart
                        [height]="400"
                        [data]="offlineChartData"
                        [legend]="['客流量', '支付笔数']"
                        x="x"
                        [y]="['y1', 'y2']"
                        [colors]="colors"
                    ></app-timeline-chart>
                </div>
            </nz-tab>
        </nz-tabset>
    </nz-card>
</div>
